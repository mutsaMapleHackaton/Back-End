{% load static %}

<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/main.css' %}" >
    <script src="https://unpkg.com/magic-snowflakes/dist/snowflakes.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script> 
    <!-- <script type="text/javascript" src="script.js"></script> -->
    <title>Document</title>

</head>

<body style="overflow:hidden; margin:0 auto; background-color:#F9D692;">
    
    <div style="position:absolute; background-color:#97704A; height:34%; width:100%; top:66%"></div>
    <img style="position:absolute; margin-left:2%; height:85%; width:18%;left:21px; display: flex;" src="{% static 'img/fireplace.png' %}">
    <div class="tree">
        <img class="treeImg" style="position:absolute; left:42%; height:86%; width:42%;" src="{% static 'img/tree.png' %}">
        <div class="letterbtn">
            <button type="button" onclick="div_show()" class="letter1"><img src="{% static 'img/letter1.png' %}"> </button>
            <button type="button" onclick="div_show()" class="letter2"><img src="{% static 'img/letter2.png' %}"> </button>
            <button type="button" onclick="div_show()" class="letter3"><img src="{% static 'img/letter3.png' %}"> </button>
            <button type="button" onclick="div_show()" class="letter4"><img src="{% static 'img/letter4.png' %}"> </button>
            <button type="button" onclick="div_show()" class="letter5"><img src="{% static 'img/letter5.png' %}"> </button>
        </div>    
        <!-- <input type="image" src="img/letter1.png" onclick="div_show()" class="letter1" > -->
        <!-- <input type="image" src="img/letter2.png" onclick="div_show()" class="letter2" >
        <input type="image" src="img/letter3.png" onclick="div_show()" class="letter3" >
        <input type="image" src="img/letter4.png" onclick="div_show()" class="letter4" >
        <input type="image" src="img/letter5.png" onclick="div_show()" class="letter5" > -->
    </div>
    <div class="ex">
        <button type="button" id="exbutton" class="exbutton" onclick="div_show2()"><img src="{% static 'img/exButton.png' %}"> </button>
    </div>
    <div class="exbox" id="exbox" style="display:none;" >
        <img src="{% static 'img/exbox.png' %}" style="position:absolute;left:20%; width:40%; height:65%">
        <div class="extext">
            <p>A Letter to Christmas</p>
            크리스마스를 축하하는 마음을 담아,<br>여러분들만의 트리에 편지를 써주세요!<br>
            편지의 글쓴이는 알 수 없지만, <br>여러분의 마음만을 알 수 있답니다.<br>    
        </div>
        <input type="image" src="{% static 'img/hidebtn.png' %}" class="hiddenbtn2" onclick="div_hide2()">
    </div>
    <div id="popup" style="display:none;"> <!--편지지조회!-->
        <img id="letterPaper" >
        <input type="image" src="{% static 'img/hidebtn.png' %}" onclick="div_hide();" class="hiddenbtn">
    </div>
    <div class="writeBtn" style="position:absolute">
        <input type="image" src="{% static 'img/writeLetterBtn.png' %}" onclick="writeLetter();">
    </div>
    <div id="letter" style="width: 630px; height: 780px;"> 
        <div id="letterForm" style="display:none;"> <!--폼작성-->
            <!-- <img class="letterFormimg" style="position:absolute">  -->
            <div>
                <img id="imtext2" style="position: absolute;">
                <input type="text"  id="imtext1" class="imtext" placeholder="소원을 빌어주세요 :)">
                <input type="image" src="{% static 'img/hidebtn.png' %}" onclick="div_hide3();" id="hiddenbtn3" class="hiddenbtn3"> 
                <button id="nextBtn" style="position: absolute; left: 44%; top:45%;" onclick="writeLetter();"></button>
            </div>    
        </div>
    </div>

    <div class="santa" style="position: absolute; left:75%; bottom:15%;">
        <img src="{% static 'img/santa.png' %}" id="santaImg">
    </div>

    <script src="https://code.jquery.com/jquery-3.6.1.js"integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="crossorigin="anonymous"></script>

    <script>
        var sf = new Snowflakes({
            color: '#ffffff'
        });
         //랜덤 이미지 추출  
        //보이기
        function div_show() {
            $.ajax({
                type : "GET",
                url: "letterShow",
                data: {},
                dataType:'json',
                success : function(response) {
                    printf("---------------", response["response"])
                    {% comment %} letterName = random.choice(response) {% endcomment %}

                    {% comment %} $("#letterPaper").attr('src',letterName);
                    $("#popup").attr('style',"block"); {% endcomment %}
                },
                error : function(a, b, c) {
                    alert("error");
                }
            });

            {% comment %} 
            var imgArray=["{% static 'img/letterp1.png' %}","{% static 'img/letterp2.png' %}","{% static 'img/letterp3.png' %}","{% static 'img/letterp4.png' %}"];
            var imgNum=Math.floor(Math.random()*3);
            var imgChange=imgArray[imgNum]; 
            {% endcomment %}
        }    
        //숨기기
        function div_hide() {
            document.getElementById("popup").style.display = "none";
        }
        //ex박스 보이기
         //보이기
        function div_show2() {
            // document.getElementById("popup").style.display = "block";
            $("#exbox").attr('style',"block");
        } 

        function div_hide2() {
            document.getElementById("exbox").style.display = "none";

        }

        function writeLetter() {
            var imgArray=["{% static 'img/letterp1.png' %}","{% static 'img/letterp2.png' %}","{% static 'img/letterp3.png' %}","{% static 'img/letterp4.png' %}"];
            var imgNum=Math.floor(Math.random()*3);
            var imgChange=imgArray[imgNum];
            console.log(imgChange);
            $("#letterForm").attr('style',"block");
            $("#imtext2").attr('src',imgChange);
        }
        function div_hide3() {
            screenShot($("#letter"));
            document.getElementById("letterForm").style.display = "none";

        }
        // div capture
        function screenShot(target) {
            console.log(target);
            if (target != null && target.length > 0) {
                var t = target[0];
                console.log(t);
                html2canvas(t).then(async function(canvas) {
                    var data = await canvas.toDataURL();
                    alert("편지가 등록되었습니다~");
                    $.ajax({
                        type : "POST",
                        url: "letterCreate",
                        data : { "data" : data },
                        dataType : "text",
                        success : function(data) {
                            console.log("1");
                        },
                        error : function(a, b, c) {
                            alert("error");
                        }
                    });
                });
                console.log("끝");
        }
    }
        

    </script>
    
</body>


</html>
<!-- <img src="./img/letter1.png"></button> -->